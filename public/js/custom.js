!function(t){"use strict";function e(e){return e.is('[type="checkbox"]')?e.prop("checked"):e.is('[type="radio"]')?!!t('[name="'+e.attr("name")+'"]:checked').length:e.is("select[multiple]")?(e.val()||[]).length:e.val()}var i=function(o,s){this.options=s,this.validators=t.extend({},i.VALIDATORS,s.custom),this.$element=t(o),this.$btn=t('button[type="submit"], input[type="submit"]').filter('[form="'+this.$element.attr("id")+'"]').add(this.$element.find('input[type="submit"], button[type="submit"]')),this.update(),this.$element.on("input.bs.validator change.bs.validator focusout.bs.validator",t.proxy(this.onInput,this)),this.$element.on("submit.bs.validator",t.proxy(this.onSubmit,this)),this.$element.on("reset.bs.validator",t.proxy(this.reset,this)),this.$element.find("[data-match]").each(function(){var i=t(this),o=i.attr("data-match");t(o).on("input.bs.validator",function(t){e(i)&&i.trigger("input.bs.validator")})}),this.$inputs.filter(function(){return e(t(this))&&!t(this).closest(".has-error").length}).trigger("focusout"),this.$element.attr("novalidate",!0)};function o(e){return this.each(function(){var o=t(this),s=t.extend({},i.DEFAULTS,o.data(),"object"==typeof e&&e),n=o.data("bs.validator");(n||"destroy"!=e)&&(n||o.data("bs.validator",n=new i(this,s)),"string"==typeof e&&n[e]())})}i.VERSION="0.11.9",i.INPUT_SELECTOR=':input:not([type="hidden"], [type="submit"], [type="reset"], button)',i.FOCUS_OFFSET=20,i.DEFAULTS={delay:500,html:!1,disable:!0,focus:!0,custom:{},errors:{match:"Does not match",minlength:"Not long enough"},feedback:{success:"glyphicon-ok",error:"glyphicon-remove"}},i.VALIDATORS={native:function(t){var e=t[0];if(e.checkValidity)return!e.checkValidity()&&!e.validity.valid&&(e.validationMessage||"error!")},match:function(e){var o=e.attr("data-match");return e.val()!==t(o).val()&&i.DEFAULTS.errors.match},minlength:function(t){var e=t.attr("data-minlength");return t.val().length<e&&i.DEFAULTS.errors.minlength}},i.prototype.update=function(){var e=this;return this.$inputs=this.$element.find(i.INPUT_SELECTOR).add(this.$element.find('[data-validate="true"]')).not(this.$element.find('[data-validate="false"]').each(function(){e.clearErrors(t(this))})),this.toggleSubmit(),this},i.prototype.onInput=function(e){var i=this,o=t(e.target),s="focusout"!==e.type;this.$inputs.is(o)&&this.validateInput(o,s).done(function(){i.toggleSubmit()})},i.prototype.validateInput=function(i,o){e(i);var s=i.data("bs.validator.errors");i.is('[type="radio"]')&&(i=this.$element.find('input[name="'+i.attr("name")+'"]'));var n=t.Event("validate.bs.validator",{relatedTarget:i[0]});if(this.$element.trigger(n),!n.isDefaultPrevented()){var a=this;return this.runValidators(i).done(function(e){i.data("bs.validator.errors",e),e.length?o?a.defer(i,a.showErrors):a.showErrors(i):a.clearErrors(i),s&&e.toString()===s.toString()||(n=e.length?t.Event("invalid.bs.validator",{relatedTarget:i[0],detail:e}):t.Event("valid.bs.validator",{relatedTarget:i[0],detail:s}),a.$element.trigger(n)),a.toggleSubmit(),a.$element.trigger(t.Event("validated.bs.validator",{relatedTarget:i[0]}))})}},i.prototype.runValidators=function(i){var o=[],s=t.Deferred();function n(t){return function(t){return i.attr("data-"+t+"-error")}(t)||((e=i[0].validity).typeMismatch?i.attr("data-type-error"):e.patternMismatch?i.attr("data-pattern-error"):e.stepMismatch?i.attr("data-step-error"):e.rangeOverflow?i.attr("data-max-error"):e.rangeUnderflow?i.attr("data-min-error"):e.valueMissing?i.attr("data-required-error"):null)||i.attr("data-error");var e}return i.data("bs.validator.deferred")&&i.data("bs.validator.deferred").reject(),i.data("bs.validator.deferred",s),t.each(this.validators,t.proxy(function(t,s){var a=null;!e(i)&&!i.attr("required")||void 0===i.attr("data-"+t)&&"native"!=t||!(a=s.call(this,i))||(a=n(t)||a,!~o.indexOf(a)&&o.push(a))},this)),!o.length&&e(i)&&i.attr("data-remote")?this.defer(i,function(){var a={};a[i.attr("name")]=e(i),t.get(i.attr("data-remote"),a).fail(function(t,e,i){o.push(n("remote")||i)}).always(function(){s.resolve(o)})}):s.resolve(o),s.promise()},i.prototype.validate=function(){var e=this;return t.when(this.$inputs.map(function(i){return e.validateInput(t(this),!1)})).then(function(){e.toggleSubmit(),e.focusError()}),this},i.prototype.focusError=function(){if(this.options.focus){var e=this.$element.find(".has-error :input:first");0!==e.length&&(t("html, body").animate({scrollTop:e.offset().top-i.FOCUS_OFFSET},250),e.focus())}},i.prototype.showErrors=function(e){var i=this.options.html?"html":"text",o=e.data("bs.validator.errors"),s=e.closest(".form-group"),n=s.find(".help-block.with-errors"),a=s.find(".form-control-feedback");o.length&&(o=t("<ul/>").addClass("list-unstyled").append(t.map(o,function(e){return t("<li/>")[i](e)})),void 0===n.data("bs.validator.originalContent")&&n.data("bs.validator.originalContent",n.html()),n.empty().append(o),s.addClass("has-error has-danger"),s.hasClass("has-feedback")&&a.removeClass(this.options.feedback.success)&&a.addClass(this.options.feedback.error)&&s.removeClass("has-success"))},i.prototype.clearErrors=function(t){var i=t.closest(".form-group"),o=i.find(".help-block.with-errors"),s=i.find(".form-control-feedback");o.html(o.data("bs.validator.originalContent")),i.removeClass("has-error has-danger has-success"),i.hasClass("has-feedback")&&s.removeClass(this.options.feedback.error)&&s.removeClass(this.options.feedback.success)&&e(t)&&s.addClass(this.options.feedback.success)&&i.addClass("has-success")},i.prototype.hasErrors=function(){return!!this.$inputs.filter(function(){return!!(t(this).data("bs.validator.errors")||[]).length}).length},i.prototype.isIncomplete=function(){return!!this.$inputs.filter("[required]").filter(function(){var i=e(t(this));return!("string"==typeof i?t.trim(i):i)}).length},i.prototype.onSubmit=function(t){this.validate(),(this.isIncomplete()||this.hasErrors())&&t.preventDefault()},i.prototype.toggleSubmit=function(){this.options.disable&&this.$btn.toggleClass("disabled",this.isIncomplete()||this.hasErrors())},i.prototype.defer=function(e,i){if(i=t.proxy(i,this,e),!this.options.delay)return i();window.clearTimeout(e.data("bs.validator.timeout")),e.data("bs.validator.timeout",window.setTimeout(i,this.options.delay))},i.prototype.reset=function(){return this.$element.find(".form-control-feedback").removeClass(this.options.feedback.error).removeClass(this.options.feedback.success),this.$inputs.removeData(["bs.validator.errors","bs.validator.deferred"]).each(function(){var e=t(this),i=e.data("bs.validator.timeout");window.clearTimeout(i)&&e.removeData("bs.validator.timeout")}),this.$element.find(".help-block.with-errors").each(function(){var e=t(this),i=e.data("bs.validator.originalContent");e.removeData("bs.validator.originalContent").html(i)}),this.$btn.removeClass("disabled"),this.$element.find(".has-error, .has-danger, .has-success").removeClass("has-error has-danger has-success"),this},i.prototype.destroy=function(){return this.reset(),this.$element.removeAttr("novalidate").removeData("bs.validator").off(".bs.validator"),this.$inputs.off(".bs.validator"),this.options=null,this.validators=null,this.$element=null,this.$btn=null,this.$inputs=null,this};var s=t.fn.validator;t.fn.validator=o,t.fn.validator.Constructor=i,t.fn.validator.noConflict=function(){return t.fn.validator=s,this},t(window).on("load",function(){t('form[data-toggle="validator"]').each(function(){var e=t(this);o.call(e,e.data())})})}(jQuery),function(t){var e;"function"==typeof define&&define.amd?define("jquery-typeahead",["jquery"],function(e){return t(e)}):"object"==typeof module&&module.exports?module.exports=(void 0===e&&(e="undefined"!=typeof window?require("jquery"):require("jquery")(void 0)),t(e)):t(jQuery)}(function(t){"use strict";function e(t,e){this.rawQuery=t.val()||"",this.query=t.val()||"",this.selector=t[0].selector,this.deferred=null,this.tmpSource={},this.source={},this.dynamicGroups=[],this.hasDynamicGroups=!1,this.generatedGroupCount=0,this.groupBy="group",this.groups=[],this.searchGroups=[],this.generateGroups=[],this.requestGroups=[],this.result=[],this.tmpResult={},this.groupTemplate="",this.resultHtml=null,this.resultCount=0,this.resultCountPerGroup={},this.options=e,this.node=t,this.namespace="."+this.helper.slugify.call(this,this.selector)+".typeahead",this.isContentEditable=void 0!==this.node.attr("contenteditable")&&"false"!==this.node.attr("contenteditable"),this.container=null,this.resultContainer=null,this.item=null,this.items=null,this.comparedItems=null,this.xhr={},this.hintIndex=null,this.filters={dropdown:{},dynamic:{}},this.dropdownFilter={static:[],dynamic:[]},this.dropdownFilterAll=null,this.isDropdownEvent=!1,this.requests={},this.backdrop={},this.hint={},this.label={},this.hasDragged=!1,this.focusOnly=!1,this.displayEmptyTemplate,this.__construct()}var i,o={input:null,minLength:2,maxLength:!(window.Typeahead={version:"2.11.1"}),maxItem:8,dynamic:!1,delay:300,order:null,offset:!1,hint:!1,accent:!1,highlight:!0,multiselect:null,group:!1,groupOrder:null,maxItemPerGroup:null,dropdownFilter:!1,dynamicFilter:null,backdrop:!1,backdropOnFocus:!1,cache:!1,ttl:36e5,compression:!1,searchOnFocus:!1,blurOnTab:!0,resultContainer:null,generateOnLoad:null,mustSelectItem:!1,href:null,display:["display"],template:null,templateValue:null,groupTemplate:null,correlativeTemplate:!1,emptyTemplate:!1,cancelButton:!0,loadingAnimation:!0,asyncResult:!1,filter:!0,matcher:null,source:null,callback:{onInit:null,onReady:null,onShowLayout:null,onHideLayout:null,onSearch:null,onResult:null,onLayoutBuiltBefore:null,onLayoutBuiltAfter:null,onNavigateBefore:null,onNavigateAfter:null,onEnter:null,onLeave:null,onClickBefore:null,onClickAfter:null,onDropdownFilter:null,onSendRequest:null,onReceiveRequest:null,onPopulateSource:null,onCacheSave:null,onSubmit:null,onCancel:null},selector:{container:"typeahead__container",result:"typeahead__result",list:"typeahead__list",group:"typeahead__group",item:"typeahead__item",empty:"typeahead__empty",display:"typeahead__display",query:"typeahead__query",filter:"typeahead__filter",filterButton:"typeahead__filter-button",dropdown:"typeahead__dropdown",dropdownItem:"typeahead__dropdown-item",labelContainer:"typeahead__label-container",label:"typeahead__label",button:"typeahead__button",backdrop:"typeahead__backdrop",hint:"typeahead__hint",cancelButton:"typeahead__cancel-button"},debug:!1},s={from:"ãàáäâẽèéëêìíïîõòóöôùúüûñç",to:"aaaaaeeeeeiiiiooooouuuunc"},n=~window.navigator.appVersion.indexOf("MSIE 9."),a=~window.navigator.appVersion.indexOf("MSIE 10"),r=!!~window.navigator.userAgent.indexOf("Trident")&&~window.navigator.userAgent.indexOf("rv:11");e.prototype={_validateCacheMethod:function(t){var e;if(!0===t)t="localStorage";else if("string"==typeof t&&!~["localStorage","sessionStorage"].indexOf(t))return!1;e=void 0!==window[t];try{window[t].setItem("typeahead","typeahead"),window[t].removeItem("typeahead")}catch(t){e=!1}return e&&t||!1},extendOptions:function(){if(this.options.cache=this._validateCacheMethod(this.options.cache),this.options.compression&&("object"==typeof LZString&&this.options.cache||(this.options.compression=!1)),this.options.maxLength&&!isNaN(this.options.maxLength)||(this.options.maxLength=1/0),void 0!==this.options.maxItem&&~[0,!1].indexOf(this.options.maxItem)&&(this.options.maxItem=1/0),this.options.maxItemPerGroup&&!/^\d+$/.test(this.options.maxItemPerGroup)&&(this.options.maxItemPerGroup=null),this.options.display&&!Array.isArray(this.options.display)&&(this.options.display=[this.options.display]),this.options.multiselect&&(this.items=[],this.comparedItems=[],"string"==typeof this.options.multiselect.matchOn&&(this.options.multiselect.matchOn=[this.options.multiselect.matchOn])),this.options.group&&(Array.isArray(this.options.group)||("string"==typeof this.options.group?this.options.group={key:this.options.group}:"boolean"==typeof this.options.group&&(this.options.group={key:"group"}),this.options.group.key=this.options.group.key||"group")),this.options.highlight&&!~["any",!0].indexOf(this.options.highlight)&&(this.options.highlight=!1),this.options.dropdownFilter&&this.options.dropdownFilter instanceof Object){Array.isArray(this.options.dropdownFilter)||(this.options.dropdownFilter=[this.options.dropdownFilter]);for(var e=0,i=this.options.dropdownFilter.length;e<i;++e)this.dropdownFilter[this.options.dropdownFilter[e].value?"static":"dynamic"].push(this.options.dropdownFilter[e])}this.options.dynamicFilter&&!Array.isArray(this.options.dynamicFilter)&&(this.options.dynamicFilter=[this.options.dynamicFilter]),this.options.accent&&("object"==typeof this.options.accent?this.options.accent.from&&this.options.accent.to&&(this.options.accent.from.length,this.options.accent.to.length):this.options.accent=s),this.options.groupTemplate&&(this.groupTemplate=this.options.groupTemplate),this.options.resultContainer&&("string"==typeof this.options.resultContainer&&(this.options.resultContainer=t(this.options.resultContainer)),this.options.resultContainer instanceof t&&this.options.resultContainer[0]&&(this.resultContainer=this.options.resultContainer)),this.options.group&&this.options.group.key&&(this.groupBy=this.options.group.key),this.options.callback&&this.options.callback.onClick&&(this.options.callback.onClickBefore=this.options.callback.onClick,delete this.options.callback.onClick),this.options.callback&&this.options.callback.onNavigate&&(this.options.callback.onNavigateBefore=this.options.callback.onNavigate,delete this.options.callback.onNavigate),this.options=t.extend(!0,{},o,this.options)},unifySourceFormat:function(){var t,e,i;for(t in this.dynamicGroups=[],Array.isArray(this.options.source)&&(this.options.source={group:{data:this.options.source}}),"string"==typeof this.options.source&&(this.options.source={group:{ajax:{url:this.options.source}}}),this.options.source.ajax&&(this.options.source={group:{ajax:this.options.source.ajax}}),(this.options.source.url||this.options.source.data)&&(this.options.source={group:this.options.source}),this.options.source)if(this.options.source.hasOwnProperty(t)){if("string"==typeof(e=this.options.source[t])&&(e={ajax:{url:e}}),i=e.url||e.ajax,Array.isArray(i)?(e.ajax="string"==typeof i[0]?{url:i[0]}:i[0],e.ajax.path=e.ajax.path||i[1]||null):"object"==typeof e.url?e.ajax=e.url:"string"==typeof e.url&&(e.ajax={url:e.url}),delete e.url,!e.data&&!e.ajax)return!1;e.display&&!Array.isArray(e.display)&&(e.display=[e.display]),e.minLength="number"==typeof e.minLength?e.minLength:this.options.minLength,e.maxLength="number"==typeof e.maxLength?e.maxLength:this.options.maxLength,e.dynamic="boolean"==typeof e.dynamic||this.options.dynamic,e.minLength>e.maxLength&&(e.minLength=e.maxLength),this.options.source[t]=e,this.options.source[t].dynamic&&this.dynamicGroups.push(t),e.cache=void 0!==e.cache?this._validateCacheMethod(e.cache):this.options.cache,e.compression&&("object"==typeof LZString&&e.cache||(e.compression=!1))}return this.hasDynamicGroups=this.options.dynamic||!!this.dynamicGroups.length,!0},init:function(){this.helper.executeCallback.call(this,this.options.callback.onInit,[this.node]),this.container=this.node.closest("."+this.options.selector.container)},delegateEvents:function(){var e=this,i=["focus"+this.namespace,"input"+this.namespace,"propertychange"+this.namespace,"keydown"+this.namespace,"keyup"+this.namespace,"search"+this.namespace,"generate"+this.namespace];t("html").on("touchmove",function(){e.hasDragged=!0}).on("touchstart",function(){e.hasDragged=!1}),this.node.closest("form").on("submit",function(t){if(!e.options.mustSelectItem||!e.helper.isEmpty(e.item))return e.options.backdropOnFocus||e.hideLayout(),e.options.callback.onSubmit?e.helper.executeCallback.call(e,e.options.callback.onSubmit,[e.node,this,e.item||e.items,t]):void 0;t.preventDefault()}).on("reset",function(){setTimeout(function(){e.node.trigger("input"+e.namespace),e.hideLayout()})});var o=!1;if(this.node.attr("placeholder")&&(a||r)){var s=!0;this.node.on("focusin focusout",function(){s=!(this.value||!this.placeholder)}),this.node.on("input",function(t){s&&(t.stopImmediatePropagation(),s=!1)})}this.node.off(this.namespace).on(i.join(" "),function(i,s){switch(i.type){case"generate":e.generateSource(Object.keys(e.options.source));break;case"focus":if(e.focusOnly){e.focusOnly=!1;break}e.options.backdropOnFocus&&(e.buildBackdropLayout(),e.showLayout()),e.options.searchOnFocus&&!e.item&&(e.deferred=t.Deferred(),e.assignQuery(),e.generateSource());break;case"keydown":8===i.keyCode&&e.options.multiselect&&e.options.multiselect.cancelOnBackspace&&""===e.query&&e.items.length?e.cancelMultiselectItem(e.items.length-1,null,i):i.keyCode&&~[9,13,27,38,39,40].indexOf(i.keyCode)&&(o=!0,e.navigate(i));break;case"keyup":n&&e.node[0].value.replace(/^\s+/,"").toString().length<e.query.length&&e.node.trigger("input"+e.namespace);break;case"propertychange":if(o){o=!1;break}case"input":e.deferred=t.Deferred(),e.assignQuery(),""===e.rawQuery&&""===e.query&&(i.originalEvent=s||{},e.helper.executeCallback.call(e,e.options.callback.onCancel,[e.node,e.item,i]),e.item=null),e.options.cancelButton&&e.toggleCancelButtonVisibility(),e.options.hint&&e.hint.container&&""!==e.hint.container.val()&&0!==e.hint.container.val().indexOf(e.rawQuery)&&(e.hint.container.val(""),e.isContentEditable&&e.hint.container.text("")),e.hasDynamicGroups?e.helper.typeWatch(function(){e.generateSource()},e.options.delay):e.generateSource();break;case"search":e.searchResult(),e.buildLayout(),e.result.length||e.searchGroups.length&&e.displayEmptyTemplate?e.showLayout():e.hideLayout(),e.deferred&&e.deferred.resolve()}return e.deferred&&e.deferred.promise()}),this.options.generateOnLoad&&this.node.trigger("generate"+this.namespace)},assignQuery:function(){this.isContentEditable?this.rawQuery=this.node.text():this.rawQuery=this.node.val().toString(),this.rawQuery=this.rawQuery.replace(/^\s+/,""),this.rawQuery!==this.query&&(this.query=this.rawQuery)},filterGenerateSource:function(){if(this.searchGroups=[],this.generateGroups=[],!this.focusOnly||this.options.multiselect)for(var t in this.options.source)if(this.options.source.hasOwnProperty(t)&&this.query.length>=this.options.source[t].minLength&&this.query.length<=this.options.source[t].maxLength){if(this.filters.dropdown&&"group"===this.filters.dropdown.key&&this.filters.dropdown.value!==t)continue;if(this.searchGroups.push(t),!this.options.source[t].dynamic&&this.source[t])continue;this.generateGroups.push(t)}},generateSource:function(e){if(this.filterGenerateSource(),this.generatedGroupCount=0,Array.isArray(e)&&e.length)this.generateGroups=e;else if(!this.generateGroups.length)return void this.node.trigger("search"+this.namespace);if(this.requestGroups=[],this.options.loadingAnimation&&this.container.addClass("loading"),!this.helper.isEmpty(this.xhr)){for(var i in this.xhr)this.xhr.hasOwnProperty(i)&&this.xhr[i].abort();this.xhr={}}for(var o,s,n,a,r,l,c,h=this,u=(i=0,this.generateGroups.length);i<u;++i){if(o=this.generateGroups[i],a=(n=this.options.source[o]).cache,r=n.compression,this.options.asyncResult&&delete this.source[o],a&&(l=window[a].getItem("TYPEAHEAD_"+this.selector+":"+o))){r&&(l=LZString.decompressFromUTF16(l)),c=!1;try{(l=JSON.parse(l+"")).data&&l.ttl>(new Date).getTime()?(this.populateSource(l.data,o),c=!0):window[a].removeItem("TYPEAHEAD_"+this.selector+":"+o)}catch(e){}if(c)continue}!n.data||n.ajax?n.ajax&&(this.requests[o]||(this.requests[o]=this.generateRequestObject(o)),this.requestGroups.push(o)):"function"==typeof n.data?(s=n.data.call(this),Array.isArray(s)?h.populateSource(s,o):"function"==typeof s.promise&&function(e){t.when(s).then(function(t){t&&Array.isArray(t)&&h.populateSource(t,e)})}(o)):this.populateSource(t.extend(!0,[],n.data),o)}return this.requestGroups.length&&this.handleRequests(),this.options.asyncResult&&this.searchGroups.length!==this.generateGroups&&this.node.trigger("search"+this.namespace),!!this.generateGroups.length},generateRequestObject:function(t){var e=this,i=this.options.source[t],o={request:{url:i.ajax.url||null,dataType:"json",beforeSend:function(o,s){e.xhr[t]=o;var n=e.requests[t].callback.beforeSend||i.ajax.beforeSend;"function"==typeof n&&n.apply(null,arguments)}},callback:{beforeSend:null,done:null,fail:null,then:null,always:null},extra:{path:i.ajax.path||null,group:t},validForGroup:[t]};if("function"!=typeof i.ajax&&(i.ajax instanceof Object&&(o=this.extendXhrObject(o,i.ajax)),1<Object.keys(this.options.source).length))for(var s in this.requests)this.requests.hasOwnProperty(s)&&(this.requests[s].isDuplicated||o.request.url&&o.request.url===this.requests[s].request.url&&(this.requests[s].validForGroup.push(t),o.isDuplicated=!0,delete o.validForGroup));return o},extendXhrObject:function(e,i){return"object"==typeof i.callback&&(e.callback=i.callback,delete i.callback),"function"==typeof i.beforeSend&&(e.callback.beforeSend=i.beforeSend,delete i.beforeSend),e.request=t.extend(!0,e.request,i),"jsonp"!==e.request.dataType.toLowerCase()||e.request.jsonpCallback||(e.request.jsonpCallback="callback_"+e.extra.group),e},handleRequests:function(){var e,i=this,o=this.requestGroups.length;if(!1!==this.helper.executeCallback.call(this,this.options.callback.onSendRequest,[this.node,this.query]))for(var s=0,n=this.requestGroups.length;s<n;++s)e=this.requestGroups[s],this.requests[e].isDuplicated||function(e,s){if("function"==typeof i.options.source[e].ajax){var n=i.options.source[e].ajax.call(i,i.query);if("object"!=typeof(s=i.extendXhrObject(i.generateRequestObject(e),"object"==typeof n?n:{})).request||!s.request.url)return i.populateSource([],e);i.requests[e]=s}var a,r=!1,l={};if(~s.request.url.indexOf("{{query}}")&&(r||(s=t.extend(!0,{},s),r=!0),s.request.url=s.request.url.replace("{{query}}",encodeURIComponent(i.query))),s.request.data)for(var c in s.request.data)if(s.request.data.hasOwnProperty(c)&&~String(s.request.data[c]).indexOf("{{query}}")){r||(s=t.extend(!0,{},s),r=!0),s.request.data[c]=s.request.data[c].replace("{{query}}",i.query);break}t.ajax(s.request).done(function(t,e,o){for(var n,r=0,c=s.validForGroup.length;r<c;r++)n=s.validForGroup[r],"function"==typeof(a=i.requests[n]).callback.done&&(l[n]=a.callback.done.call(i,t,e,o))}).fail(function(t,e,o){for(var n=0,r=s.validForGroup.length;n<r;n++)(a=i.requests[s.validForGroup[n]]).callback.fail instanceof Function&&a.callback.fail.call(i,t,e,o)}).always(function(t,e,n){for(var r,c=0,h=s.validForGroup.length;c<h;c++){if(r=s.validForGroup[c],(a=i.requests[r]).callback.always instanceof Function&&a.callback.always.call(i,t,e,n),"abort"===e)return;i.populateSource(null!==t&&"function"==typeof t.promise&&[]||l[r]||t,a.extra.group,a.extra.path||a.request.path),0==(o-=1)&&i.helper.executeCallback.call(i,i.options.callback.onReceiveRequest,[i.node,i.query])}}).then(function(t,e){for(var o=0,n=s.validForGroup.length;o<n;o++)(a=i.requests[s.validForGroup[o]]).callback.then instanceof Function&&a.callback.then.call(i,t,e)})}(e,this.requests[e])},populateSource:function(e,i,o){var s=this,n=this.options.source[i],a=n.ajax&&n.data;o&&"string"==typeof o&&(e=this.helper.namespace.call(this,o,e)),Array.isArray(e)||(e=[]),a&&("function"==typeof a&&(a=a()),Array.isArray(a)&&(e=e.concat(a)));for(var r,l=n.display?"compiled"===n.display[0]?n.display[1]:n.display[0]:"compiled"===this.options.display[0]?this.options.display[1]:this.options.display[0],c=0,h=e.length;c<h;c++)null!==e[c]&&"boolean"!=typeof e[c]&&("string"==typeof e[c]&&((r={})[l]=e[c],e[c]=r),e[c].group=i);if(!this.hasDynamicGroups&&this.dropdownFilter.dynamic.length){var u,p,d={};for(c=0,h=e.length;c<h;c++)for(var f=0,m=this.dropdownFilter.dynamic.length;f<m;f++)u=this.dropdownFilter.dynamic[f].key,(p=e[c][u])&&(this.dropdownFilter.dynamic[f].value||(this.dropdownFilter.dynamic[f].value=[]),d[u]||(d[u]=[]),~d[u].indexOf(p.toLowerCase())||(d[u].push(p.toLowerCase()),this.dropdownFilter.dynamic[f].value.push(p)))}if(this.options.correlativeTemplate){var g=n.template||this.options.template,y="";if("function"==typeof g&&(g=g.call(this,"",{})),g){if(Array.isArray(this.options.correlativeTemplate))for(c=0,h=this.options.correlativeTemplate.length;c<h;c++)y+="{{"+this.options.correlativeTemplate[c]+"}} ";else y=g.replace(/<.+?>/g," ").replace(/\s{2,}/," ").trim();for(c=0,h=e.length;c<h;c++)e[c].compiled=t("<textarea />").html(y.replace(/\{\{([\w\-\.]+)(?:\|(\w+))?}}/g,function(t,i){return s.helper.namespace.call(s,i,e[c],"get","")}).trim()).text();n.display?~n.display.indexOf("compiled")||n.display.unshift("compiled"):~this.options.display.indexOf("compiled")||this.options.display.unshift("compiled")}}this.options.callback.onPopulateSource&&(e=this.helper.executeCallback.call(this,this.options.callback.onPopulateSource,[this.node,e,i,o])),this.tmpSource[i]=Array.isArray(e)&&e||[];var v=this.options.source[i].cache,b=this.options.source[i].compression,k=this.options.source[i].ttl||this.options.ttl;if(v&&!window[v].getItem("TYPEAHEAD_"+this.selector+":"+i)){this.options.callback.onCacheSave&&(e=this.helper.executeCallback.call(this,this.options.callback.onCacheSave,[this.node,e,i,o]));var w=JSON.stringify({data:e,ttl:(new Date).getTime()+k});b&&(w=LZString.compressToUTF16(w)),window[v].setItem("TYPEAHEAD_"+this.selector+":"+i,w)}this.incrementGeneratedGroup(i)},incrementGeneratedGroup:function(t){if(this.generatedGroupCount++,this.generatedGroupCount===this.generateGroups.length||this.options.asyncResult){this.xhr&&this.xhr[t]&&delete this.xhr[t];for(var e=0,i=this.generateGroups.length;e<i;e++)this.source[this.generateGroups[e]]=this.tmpSource[this.generateGroups[e]];this.hasDynamicGroups||this.buildDropdownItemLayout("dynamic"),this.generatedGroupCount===this.generateGroups.length&&(this.xhr={},this.options.loadingAnimation&&this.container.removeClass("loading")),this.node.trigger("search"+this.namespace)}},navigate:function(t){if(this.helper.executeCallback.call(this,this.options.callback.onNavigateBefore,[this.node,this.query,t]),27===t.keyCode)return t.preventDefault(),void(this.query.length?(this.resetInput(),this.node.trigger("input"+this.namespace,[t])):(this.node.blur(),this.hideLayout()));if(this.result.length){var e,i=this.resultContainer.find("."+this.options.selector.item).not("[disabled]"),o=i.filter(".active"),s=o[0]?i.index(o):null,n=o[0]?o.attr("data-index"):null,a=null;if(this.clearActiveItem(),this.helper.executeCallback.call(this,this.options.callback.onLeave,[this.node,null!==s&&i.eq(s)||void 0,null!==n&&this.result[n]||void 0,t]),13===t.keyCode)return t.preventDefault(),void(0<o.length?"javascript:;"===o.find("a:first")[0].href?o.find("a:first").trigger("click",t):o.find("a:first")[0].click():this.node.closest("form").trigger("submit"));if(39!==t.keyCode){9===t.keyCode?this.options.blurOnTab?this.hideLayout():0<o.length?s+1<i.length?(t.preventDefault(),a=s+1,this.addActiveItem(i.eq(a))):this.hideLayout():i.length?(t.preventDefault(),a=0,this.addActiveItem(i.first())):this.hideLayout():38===t.keyCode?(t.preventDefault(),0<o.length?0<=s-1&&(a=s-1,this.addActiveItem(i.eq(a))):i.length&&(a=i.length-1,this.addActiveItem(i.last()))):40===t.keyCode&&(t.preventDefault(),0<o.length?s+1<i.length&&(a=s+1,this.addActiveItem(i.eq(a))):i.length&&(a=0,this.addActiveItem(i.first()))),e=null!==a?i.eq(a).attr("data-index"):null,this.helper.executeCallback.call(this,this.options.callback.onEnter,[this.node,null!==a&&i.eq(a)||void 0,null!==e&&this.result[e]||void 0,t]),t.preventInputChange&&~[38,40].indexOf(t.keyCode)&&this.buildHintLayout(null!==e&&e<this.result.length?[this.result[e]]:null),this.options.hint&&this.hint.container&&this.hint.container.css("color",t.preventInputChange?this.hint.css.color:null===e&&this.hint.css.color||this.hint.container.css("background-color")||"fff");var r=null===e||t.preventInputChange?this.rawQuery:this.getTemplateValue.call(this,this.result[e]);this.node.val(r),this.isContentEditable&&this.node.text(r),this.helper.executeCallback.call(this,this.options.callback.onNavigateAfter,[this.node,i,null!==a&&i.eq(a).find("a:first")||void 0,null!==e&&this.result[e]||void 0,this.query,t])}else null!==s?i.eq(s).find("a:first")[0].click():this.options.hint&&""!==this.hint.container.val()&&this.helper.getCaret(this.node[0])>=this.query.length&&i.filter('[data-index="'+this.hintIndex+'"]').find("a:first")[0].click()}},getTemplateValue:function(t){if(t){var e=t.group&&this.options.source[t.group].templateValue||this.options.templateValue;if("function"==typeof e&&(e=e.call(this)),!e)return this.helper.namespace.call(this,t.matchedKey,t).toString();var i=this;return e.replace(/\{\{([\w\-.]+)}}/gi,function(e,o){return i.helper.namespace.call(i,o,t,"get","")})}},clearActiveItem:function(){this.resultContainer.find("."+this.options.selector.item).removeClass("active")},addActiveItem:function(t){t.addClass("active")},searchResult:function(){this.resetLayout(),!1!==this.helper.executeCallback.call(this,this.options.callback.onSearch,[this.node,this.query])&&(!this.searchGroups.length||this.options.multiselect&&this.options.multiselect.limit&&this.items.length>=this.options.multiselect.limit||this.searchResultData(),this.helper.executeCallback.call(this,this.options.callback.onResult,[this.node,this.query,this.result,this.resultCount,this.resultCountPerGroup]),this.isDropdownEvent&&(this.helper.executeCallback.call(this,this.options.callback.onDropdownFilter,[this.node,this.query,this.filters.dropdown,this.result]),this.isDropdownEvent=!1))},searchResultData:function(){var e,i,o,s,n,a,r,l,c,h,u,p=this.groupBy,d=null,f=this.query.toLowerCase(),m=this.options.maxItem,g=this.options.maxItemPerGroup,y=this.filters.dynamic&&!this.helper.isEmpty(this.filters.dynamic),v="function"==typeof this.options.matcher&&this.options.matcher;this.options.accent&&(f=this.helper.removeAccent.call(this,f));for(var b=0,k=this.searchGroups.length;b<k;++b)if(A=this.searchGroups[b],(!this.filters.dropdown||"group"!==this.filters.dropdown.key||this.filters.dropdown.value===A)&&(n=void 0!==this.options.source[A].filter?this.options.source[A].filter:this.options.filter,r="function"==typeof this.options.source[A].matcher&&this.options.source[A].matcher||v,this.source[A]))for(var w=0,x=this.source[A].length;w<x&&(!(this.resultItemCount>=m)||this.options.callback.onResult);w++)if((!y||this.dynamicFilter.validate.apply(this,[this.source[A][w]]))&&null!==(e=this.source[A][w])&&"boolean"!=typeof e&&(!this.options.multiselect||this.isMultiselectUniqueData(e))&&(!this.filters.dropdown||(e[this.filters.dropdown.key]||"").toLowerCase()===(this.filters.dropdown.value||"").toLowerCase())){if((d="group"===p?A:e[p]?e[p]:e.group)&&!this.tmpResult[d]&&(this.tmpResult[d]=[],this.resultCountPerGroup[d]=0),g&&"group"===p&&this.tmpResult[d].length>=g&&!this.options.callback.onResult)break;for(var C=0,q=(O=this.options.source[A].display||this.options.display).length;C<q;++C){if(!1!==n){if(void 0===(s=/\./.test(O[C])?this.helper.namespace.call(this,O[C],e):e[O[C]])||""===s)continue;s=this.helper.cleanStringFromScript(s)}if("function"==typeof n){if(void 0===(a=n.call(this,e,s)))break;if(!a)continue;"object"==typeof a&&(e=a)}if(~[void 0,!0].indexOf(n)){if(null===s)continue;if(o=(o=s).toString().toLowerCase(),this.options.accent&&(o=this.helper.removeAccent.call(this,o)),i=o.indexOf(f),this.options.correlativeTemplate&&"compiled"===O[C]&&i<0&&/\s/.test(f)){c=!0,u=o;for(var $=0,_=(h=f.split(" ")).length;$<_;$++)if(""!==h[$]){if(!~u.indexOf(h[$])){c=!1;break}u=u.replace(h[$],"")}}if(i<0&&!c)continue;if(this.options.offset&&0!==i)continue;if(r){if(void 0===(l=r.call(this,e,s)))break;if(!l)continue;"object"==typeof l&&(e=l)}}if(this.resultCount++,this.resultCountPerGroup[d]++,this.resultItemCount<m){if(g&&this.tmpResult[d].length>=g)break;this.tmpResult[d].push(t.extend(!0,{matchedKey:O[C]},e)),this.resultItemCount++}break}if(!this.options.callback.onResult){if(this.resultItemCount>=m)break;if(g&&this.tmpResult[d].length>=g&&"group"===p)break}}if(this.options.order){var S,O=[];for(var A in this.tmpResult)if(this.tmpResult.hasOwnProperty(A)){for(b=0,k=this.tmpResult[A].length;b<k;b++)S=this.options.source[this.tmpResult[A][b].group].display||this.options.display,~O.indexOf(S[0])||O.push(S[0]);this.tmpResult[A].sort(this.helper.sort(O,"asc"===this.options.order,function(t){return t?t.toString().toUpperCase():""}))}}var T,F=[];for(b=0,k=(T="function"==typeof this.options.groupOrder?this.options.groupOrder.apply(this,[this.node,this.query,this.tmpResult,this.resultCount,this.resultCountPerGroup]):Array.isArray(this.options.groupOrder)?this.options.groupOrder:"string"==typeof this.options.groupOrder&&~["asc","desc"].indexOf(this.options.groupOrder)?Object.keys(this.tmpResult).sort(this.helper.sort([],"asc"===this.options.groupOrder,function(t){return t.toString().toUpperCase()})):Object.keys(this.tmpResult)).length;b<k;b++)F=F.concat(this.tmpResult[T[b]]||[]);this.groups=JSON.parse(JSON.stringify(T)),this.result=F},buildLayout:function(){this.buildHtmlLayout(),this.buildBackdropLayout(),this.buildHintLayout(),this.options.callback.onLayoutBuiltBefore&&(this.tmpResultHtml=this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltBefore,[this.node,this.query,this.result,this.resultHtml])),this.tmpResultHtml instanceof t?this.resultContainer.html(this.tmpResultHtml):this.resultHtml instanceof t&&this.resultContainer.html(this.resultHtml),this.options.callback.onLayoutBuiltAfter&&this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltAfter,[this.node,this.query,this.result])},buildHtmlLayout:function(){if(!1!==this.options.resultContainer){var e;if(this.resultContainer||(this.resultContainer=t("<div/>",{class:this.options.selector.result}),this.container.append(this.resultContainer)),!this.result.length&&this.generatedGroupCount===this.generateGroups.length)if(this.options.multiselect&&this.options.multiselect.limit&&this.items.length>=this.options.multiselect.limit)e=this.options.multiselect.limitTemplate?"function"==typeof this.options.multiselect.limitTemplate?this.options.multiselect.limitTemplate.call(this,this.query):this.options.multiselect.limitTemplate.replace(/\{\{query}}/gi,t("<div>").text(this.helper.cleanStringFromScript(this.query)).html()):"Can't select more than "+this.items.length+" items.";else{if(!this.options.emptyTemplate||""===this.query)return;e="function"==typeof this.options.emptyTemplate?this.options.emptyTemplate.call(this,this.query):this.options.emptyTemplate.replace(/\{\{query}}/gi,t("<div>").text(this.helper.cleanStringFromScript(this.query)).html())}this.displayEmptyTemplate=!!e;var i=this.query.toLowerCase();this.options.accent&&(i=this.helper.removeAccent.call(this,i));var o=this,s=this.groupTemplate||"<ul></ul>",n=!1;this.groupTemplate?s=t(s.replace(/<([^>]+)>\{\{(.+?)}}<\/[^>]+>/g,function(t,i,s,a,r){var l="",c="group"===s?o.groups:[s];if(!o.result.length)return!0===n?"":(n=!0,"<"+i+' class="'+o.options.selector.empty+'">'+e+"</"+i+">");for(var h=0,u=c.length;h<u;++h)l+="<"+i+' data-group-template="'+c[h]+'"><ul></ul></'+i+">";return l})):(s=t(s),this.result.length||s.append(e instanceof t?e:'<li class="'+o.options.selector.empty+'">'+e+"</li>")),s.addClass(this.options.selector.list+(this.helper.isEmpty(this.result)?" empty":""));for(var a,r,l,c,h,u,p,d,f,m,g,y,v,b=this.groupTemplate&&this.result.length&&o.groups||[],k=0,w=this.result.length;k<w;++k)a=(l=this.result[k]).group,c=!this.options.multiselect&&this.options.source[l.group].href||this.options.href,d=[],f=this.options.source[l.group].display||this.options.display,this.options.group&&(a=l[this.options.group.key],this.options.group.template&&("function"==typeof this.options.group.template?r=this.options.group.template.call(this,l):"string"==typeof this.options.group.template&&(r=this.options.group.template.replace(/\{\{([\w\-\.]+)}}/gi,function(t,e){return o.helper.namespace.call(o,e,l,"get","")}))),s.find('[data-search-group="'+a+'"]')[0]||(this.groupTemplate?s.find('[data-group-template="'+a+'"] ul'):s).append(t("<li/>",{class:o.options.selector.group,html:t("<a/>",{href:"javascript:;",html:r||a,tabindex:-1}),"data-search-group":a}))),this.groupTemplate&&b.length&&~(g=b.indexOf(a||l.group))&&b.splice(g,1),h=t("<li/>",{class:o.options.selector.item+" "+o.options.selector.group+"-"+this.helper.slugify.call(this,a),disabled:!!l.disabled,"data-group":a,"data-index":k,html:t("<a/>",{href:c&&!l.disabled?(y=c,v=l,v.href=o.generateHref.call(o,y,v)):"javascript:;",html:function(){if(u=l.group&&o.options.source[l.group].template||o.options.template)"function"==typeof u&&(u=u.call(o,o.query,l)),p=u.replace(/\{\{([^\|}]+)(?:\|([^}]+))*}}/gi,function(t,e,s){var n=o.helper.cleanStringFromScript(String(o.helper.namespace.call(o,e,l,"get","")));return~(s=s&&s.split("|")||[]).indexOf("slugify")&&(n=o.helper.slugify.call(o,n)),~s.indexOf("raw")||!0===o.options.highlight&&i&&~f.indexOf(e)&&(n=o.helper.highlight.call(o,n,i.split(" "),o.options.accent)),n});else{for(var e=0,s=f.length;e<s;e++)void 0!==(m=/\./.test(f[e])?o.helper.namespace.call(o,f[e],l,"get",""):l[f[e]])&&""!==m&&d.push(m);p='<span class="'+o.options.selector.display+'">'+o.helper.cleanStringFromScript(String(d.join(" ")))+"</span>"}(!0===o.options.highlight&&i&&!u||"any"===o.options.highlight)&&(p=o.helper.highlight.call(o,p,i.split(" "),o.options.accent)),t(this).append(p)}})}),function(e,i,s){s.on("click",function(e,s){i.disabled?e.preventDefault():(s&&"object"==typeof s&&(e.originalEvent=s),o.options.mustSelectItem&&o.helper.isEmpty(i)?e.preventDefault():(o.options.multiselect||(o.item=i),!1!==o.helper.executeCallback.call(o,o.options.callback.onClickBefore,[o.node,t(this),i,e])&&(e.originalEvent&&e.originalEvent.defaultPrevented||e.isDefaultPrevented()||(o.options.multiselect?(o.query=o.rawQuery="",o.addMultiselectItemLayout(i)):(o.focusOnly=!0,o.query=o.rawQuery=o.getTemplateValue.call(o,i),o.isContentEditable&&(o.node.text(o.query),o.helper.setCaretAtEnd(o.node[0]))),o.hideLayout(),o.node.val(o.query).focus(),o.options.cancelButton&&o.toggleCancelButtonVisibility(),o.helper.executeCallback.call(o,o.options.callback.onClickAfter,[o.node,t(this),i,e])))))}),s.on("mouseenter",function(e){i.disabled||(o.clearActiveItem(),o.addActiveItem(t(this))),o.helper.executeCallback.call(o,o.options.callback.onEnter,[o.node,t(this),i,e])}),s.on("mouseleave",function(e){i.disabled||o.clearActiveItem(),o.helper.executeCallback.call(o,o.options.callback.onLeave,[o.node,t(this),i,e])})}(0,l,h),(this.groupTemplate?s.find('[data-group-template="'+a+'"] ul'):s).append(h);if(this.result.length&&b.length)for(k=0,w=b.length;k<w;++k)s.find('[data-group-template="'+b[k]+'"]').remove();this.resultHtml=s}},generateHref:function(t,e){var i=this;return"string"==typeof t?t=t.replace(/\{\{([^\|}]+)(?:\|([^}]+))*}}/gi,function(t,o,s){var n=i.helper.namespace.call(i,o,e,"get","");return~(s=s&&s.split("|")||[]).indexOf("slugify")&&(n=i.helper.slugify.call(i,n)),n}):"function"==typeof t&&(t=t.call(this,e)),t},getMultiselectComparedData:function(t){var e="";if(Array.isArray(this.options.multiselect.matchOn))for(var i=0,o=this.options.multiselect.matchOn.length;i<o;++i)e+=void 0!==t[this.options.multiselect.matchOn[i]]?t[this.options.multiselect.matchOn[i]]:"";else{var s=JSON.parse(JSON.stringify(t)),n=["group","matchedKey","compiled","href"];for(i=0,o=n.length;i<o;++i)delete s[n[i]];e=JSON.stringify(s)}return e},buildBackdropLayout:function(){this.options.backdrop&&(this.backdrop.container||(this.backdrop.css=t.extend({opacity:.6,filter:"alpha(opacity=60)",position:"fixed",top:0,right:0,bottom:0,left:0,"z-index":1040,"background-color":"#000"},this.options.backdrop),this.backdrop.container=t("<div/>",{class:this.options.selector.backdrop,css:this.backdrop.css}).insertAfter(this.container)),this.container.addClass("backdrop").css({"z-index":this.backdrop.css["z-index"]+1,position:"relative"}))},buildHintLayout:function(e){if(this.options.hint)if(this.node[0].scrollWidth>Math.ceil(this.node.innerWidth()))this.hint.container&&this.hint.container.val("");else{var i=this,o="",s=(e=e||this.result,this.query.toLowerCase());if(this.options.accent&&(s=this.helper.removeAccent.call(this,s)),this.hintIndex=null,this.searchGroups.length){if(this.hint.container||(this.hint.css=t.extend({"border-color":"transparent",position:"absolute",top:0,display:"inline","z-index":-1,float:"none",color:"silver","box-shadow":"none",cursor:"default","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"},this.options.hint),this.hint.container=t("<"+this.node[0].nodeName+"/>",{type:this.node.attr("type"),class:this.node.attr("class"),readonly:!0,unselectable:"on","aria-hidden":"true",tabindex:-1,click:function(){i.node.focus()}}).addClass(this.options.selector.hint).css(this.hint.css).insertAfter(this.node),this.node.parent().css({position:"relative"})),this.hint.container.css("color",this.hint.css.color),s)for(var n,a,r,l=0,c=e.length;l<c;l++)if(!e[l].disabled){a=e[l].group;for(var h=0,u=(n=this.options.source[a].display||this.options.display).length;h<u;h++)if(r=String(e[l][n[h]]).toLowerCase(),this.options.accent&&(r=this.helper.removeAccent.call(this,r)),0===r.indexOf(s)){o=String(e[l][n[h]]),this.hintIndex=l;break}if(null!==this.hintIndex)break}var p=0<o.length&&this.rawQuery+o.substring(this.query.length)||"";this.hint.container.val(p),this.isContentEditable&&this.hint.container.text(p)}}},buildDropdownLayout:function(){if(this.options.dropdownFilter){var e=this;t("<span/>",{class:this.options.selector.filter,html:function(){t(this).append(t("<button/>",{type:"button",class:e.options.selector.filterButton,style:"display: none;",click:function(){e.container.toggleClass("filter");var i=e.namespace+"-dropdown-filter";t("html").off(i),e.container.hasClass("filter")&&t("html").on("click"+i+" touchend"+i,function(o){t(o.target).closest("."+e.options.selector.filter)[0]&&t(o.target).closest(e.container)[0]||e.hasDragged||(e.container.removeClass("filter"),t("html").off(i))})}})),t(this).append(t("<ul/>",{class:e.options.selector.dropdown}))}}).insertAfter(e.container.find("."+e.options.selector.query))}},buildDropdownItemLayout:function(e){if(this.options.dropdownFilter){var i,o,s=this,n="string"==typeof this.options.dropdownFilter&&this.options.dropdownFilter||"All",a=this.container.find("."+this.options.selector.dropdown);"static"!==e||!0!==this.options.dropdownFilter&&"string"!=typeof this.options.dropdownFilter||this.dropdownFilter.static.push({key:"group",template:"{{group}}",all:n,value:Object.keys(this.options.source)});for(var r=0,l=this.dropdownFilter[e].length;r<l;r++){o=this.dropdownFilter[e][r],Array.isArray(o.value)||(o.value=[o.value]),o.all&&(this.dropdownFilterAll=o.all);for(var c=0,h=o.value.length;c<=h;c++)c===h&&r!==l-1||c===h&&r===l-1&&"static"===e&&this.dropdownFilter.dynamic.length||(i=this.dropdownFilterAll||n,o.value[c]?i=o.template?o.template.replace(new RegExp("{{"+o.key+"}}","gi"),o.value[c]):o.value[c]:this.container.find("."+s.options.selector.filterButton).html(i),function(e,i,o){a.append(t("<li/>",{class:s.options.selector.dropdownItem+" "+s.helper.slugify.call(s,i.key+"-"+(i.value[e]||n)),html:t("<a/>",{href:"javascript:;",html:o,click:function(t){t.preventDefault(),u.call(s,{key:i.key,value:i.value[e]||"*",template:o})}})}))}(c,o,i))}this.dropdownFilter[e].length&&this.container.find("."+s.options.selector.filterButton).removeAttr("style")}function u(t){"*"===t.value?delete this.filters.dropdown:this.filters.dropdown=t,this.container.removeClass("filter").find("."+this.options.selector.filterButton).html(t.template),this.isDropdownEvent=!0,this.node.trigger("input"+this.namespace),this.options.multiselect&&this.adjustInputSize(),this.node.focus()}},dynamicFilter:{init:function(){this.options.dynamicFilter&&(this.dynamicFilter.bind.call(this),this.isDynamicFilterEnabled=!0)},validate:function(t){var e,i,o=null,s=null;for(var n in this.filters.dynamic)if(this.filters.dynamic.hasOwnProperty(n)&&(i=~n.indexOf(".")?this.helper.namespace.call(this,n,t,"get"):t[n],"|"!==this.filters.dynamic[n].modifier||o||(o=i==this.filters.dynamic[n].value||!1),"&"===this.filters.dynamic[n].modifier)){if(i!=this.filters.dynamic[n].value){s=!1;break}s=!0}return e=o,null!==s&&!0===(e=s)&&null!==o&&(e=o),!!e},set:function(t,e){var i=t.match(/^([|&])?(.+)/);e?this.filters.dynamic[i[2]]={modifier:i[1]||"|",value:e}:delete this.filters.dynamic[i[2]],this.isDynamicFilterEnabled&&this.generateSource()},bind:function(){for(var e,i=this,o=0,s=this.options.dynamicFilter.length;o<s;o++)"string"==typeof(e=this.options.dynamicFilter[o]).selector&&(e.selector=t(e.selector)),e.selector instanceof t&&e.selector[0]&&e.key&&function(t){t.selector.off(i.namespace).on("change"+i.namespace,function(){i.dynamicFilter.set.apply(i,[t.key,i.dynamicFilter.getValue(this)])}).trigger("change"+i.namespace)}(e)},getValue:function(t){var e;return"SELECT"===t.tagName?e=t.value:"INPUT"===t.tagName&&("checkbox"===t.type?e=t.checked&&t.getAttribute("value")||t.checked||null:"radio"===t.type&&t.checked&&(e=t.value)),e}},buildMultiselectLayout:function(){if(this.options.multiselect){var e,i=this;this.label.container=t("<span/>",{class:this.options.selector.labelContainer,"data-padding-left":parseFloat(this.node.css("padding-left"))||0,"data-padding-right":parseFloat(this.node.css("padding-right"))||0,"data-padding-top":parseFloat(this.node.css("padding-top"))||0,click:function(e){t(e.target).hasClass(i.options.selector.labelContainer)&&i.node.focus()}}),this.node.closest("."+this.options.selector.query).prepend(this.label.container),this.options.multiselect.data&&(Array.isArray(this.options.multiselect.data)?this.populateMultiselectData(this.options.multiselect.data):"function"==typeof this.options.multiselect.data&&(e=this.options.multiselect.data.call(this),Array.isArray(e)?this.populateMultiselectData(e):"function"==typeof e.promise&&t.when(e).then(function(t){t&&Array.isArray(t)&&i.populateMultiselectData(t)})))}},isMultiselectUniqueData:function(t){for(var e=!0,i=0,o=this.comparedItems.length;i<o;++i)if(this.comparedItems[i]===this.getMultiselectComparedData(t)){e=!1;break}return e},populateMultiselectData:function(t){for(var e=0,i=t.length;e<i;++e)this.addMultiselectItemLayout(t[e]);this.node.trigger("search"+this.namespace,{origin:"populateMultiselectData"})},addMultiselectItemLayout:function(e){if(this.isMultiselectUniqueData(e)){this.items.push(e),this.comparedItems.push(this.getMultiselectComparedData(e));var i,o=this.getTemplateValue(e),s=this,n=this.options.multiselect.href?"a":"span",a=t("<span/>",{class:this.options.selector.label,html:t("<"+n+"/>",{text:o,click:function(e){var i=t(this).closest("."+s.options.selector.label),o=s.label.container.find("."+s.options.selector.label).index(i);s.options.multiselect.callback&&s.helper.executeCallback.call(s,s.options.multiselect.callback.onClick,[s.node,s.items[o],e])},href:this.options.multiselect.href?(i=s.items[s.items.length-1],s.generateHref.call(s,s.options.multiselect.href,i)):null})});return a.append(t("<span/>",{class:this.options.selector.cancelButton,html:"×",click:function(e){var i=t(this).closest("."+s.options.selector.label),o=s.label.container.find("."+s.options.selector.label).index(i);s.cancelMultiselectItem(o,i,e)}})),this.label.container.append(a),this.adjustInputSize(),!0}},cancelMultiselectItem:function(t,e,i){var o=this.items[t];(e=e||this.label.container.find("."+this.options.selector.label).eq(t)).remove(),this.items.splice(t,1),this.comparedItems.splice(t,1),this.options.multiselect.callback&&this.helper.executeCallback.call(this,this.options.multiselect.callback.onCancel,[this.node,o,i]),this.adjustInputSize(),this.focusOnly=!0,this.node.focus().trigger("input"+this.namespace,{origin:"cancelMultiselectItem"})},adjustInputSize:function(){var e=this.node[0].getBoundingClientRect().width-(parseFloat(this.label.container.data("padding-right"))||0)-(parseFloat(this.label.container.css("padding-left"))||0),i=0,o=0,s=0,n=!1,a=0;this.label.container.find("."+this.options.selector.label).filter(function(r,l){0===r&&(a=t(l)[0].getBoundingClientRect().height+parseFloat(t(l).css("margin-bottom")||0)),i=t(l)[0].getBoundingClientRect().width+parseFloat(t(l).css("margin-right")||0),.7*e<s+i&&!n&&(o++,n=!0),s+i<e?s+=i:(n=!1,s=i)});var r=parseFloat(this.label.container.data("padding-left")||0)+(n?0:s),l=o*a+parseFloat(this.label.container.data("padding-top")||0);this.container.find("."+this.options.selector.query).find("input, textarea, [contenteditable], .typeahead__hint").css({paddingLeft:r,paddingTop:l})},showLayout:function(){!this.container.hasClass("result")&&(this.result.length||this.displayEmptyTemplate||this.options.backdropOnFocus)&&(function(){var e=this;t("html").off("keydown"+this.namespace).on("keydown"+this.namespace,function(i){i.keyCode&&9===i.keyCode&&setTimeout(function(){t(":focus").closest(e.container).find(e.node)[0]||e.hideLayout()},0)}),t("html").off("click"+this.namespace+" touchend"+this.namespace).on("click"+this.namespace+" touchend"+this.namespace,function(i){t(i.target).closest(e.container)[0]||t(i.target).closest("."+e.options.selector.item)[0]||i.target.className===e.options.selector.cancelButton||e.hasDragged||e.hideLayout()})}.call(this),this.container.addClass([this.result.length||this.searchGroups.length&&this.displayEmptyTemplate?"result ":"",this.options.hint&&this.searchGroups.length?"hint":"",this.options.backdrop||this.options.backdropOnFocus?"backdrop":""].join(" ")),this.helper.executeCallback.call(this,this.options.callback.onShowLayout,[this.node,this.query]))},hideLayout:function(){(this.container.hasClass("result")||this.container.hasClass("backdrop"))&&(this.container.removeClass("result hint filter"+(this.options.backdropOnFocus&&t(this.node).is(":focus")?"":" backdrop")),this.options.backdropOnFocus&&this.container.hasClass("backdrop")||(t("html").off(this.namespace),this.helper.executeCallback.call(this,this.options.callback.onHideLayout,[this.node,this.query])))},resetLayout:function(){this.result=[],this.tmpResult={},this.groups=[],this.resultCount=0,this.resultCountPerGroup={},this.resultItemCount=0,this.resultHtml=null,this.options.hint&&this.hint.container&&(this.hint.container.val(""),this.isContentEditable&&this.hint.container.text(""))},resetInput:function(){this.node.val(""),this.isContentEditable&&this.node.text(""),this.query="",this.rawQuery=""},buildCancelButtonLayout:function(){if(this.options.cancelButton){var e=this;t("<span/>",{class:this.options.selector.cancelButton,html:"×",mousedown:function(t){t.stopImmediatePropagation(),t.preventDefault(),e.resetInput(),e.node.trigger("input"+e.namespace,[t])}}).insertBefore(this.node)}},toggleCancelButtonVisibility:function(){this.container.toggleClass("cancel",!!this.query.length)},__construct:function(){this.extendOptions(),this.unifySourceFormat()&&(this.dynamicFilter.init.apply(this),this.init(),this.buildDropdownLayout(),this.buildDropdownItemLayout("static"),this.buildMultiselectLayout(),this.delegateEvents(),this.buildCancelButtonLayout(),this.helper.executeCallback.call(this,this.options.callback.onReady,[this.node]))},helper:{isEmpty:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},removeAccent:function(t){if("string"==typeof t){var e=s;return"object"==typeof this.options.accent&&(e=this.options.accent),t.toLowerCase().replace(new RegExp("["+e.from+"]","g"),function(t){return e.to[e.from.indexOf(t)]})}},slugify:function(t){return""!==(t=String(t))&&(t=(t=this.helper.removeAccent.call(this,t)).replace(/[^-a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")),t},sort:function(t,e,i){function o(e){for(var o=0,s=t.length;o<s;o++)if(void 0!==e[t[o]])return i(e[t[o]]);return e}return e=[-1,1][+!!e],function(t,i){return t=o(t),i=o(i),e*((i<t)-(t<i))}},replaceAt:function(t,e,i,o){return t.substring(0,e)+o+t.substring(e+i)},highlight:function(t,e,i){t=String(t);var o=i&&this.helper.removeAccent.call(this,t)||t,s=[];Array.isArray(e)||(e=[e]),e.sort(function(t,e){return e.length-t.length});for(var n=e.length-1;0<=n;n--)""!==e[n].trim()?e[n]=e[n].replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):e.splice(n,1);for(o.replace(new RegExp("(?:"+e.join("|")+")(?!([^<]+)?>)","gi"),function(t,e,i){s.push({offset:i,length:t.length})}),n=s.length-1;0<=n;n--)t=this.helper.replaceAt(t,s[n].offset,s[n].length,"<strong>"+t.substr(s[n].offset,s[n].length)+"</strong>");return t},getCaret:function(t){var e=0;if(t.selectionStart)return t.selectionStart;if(document.selection){var i=document.selection.createRange();if(null===i)return e;var o=t.createTextRange(),s=o.duplicate();o.moveToBookmark(i.getBookmark()),s.setEndPoint("EndToStart",o),e=s.text.length}else if(window.getSelection){var n=window.getSelection();if(n.rangeCount){var a=n.getRangeAt(0);a.commonAncestorContainer.parentNode==t&&(e=a.endOffset)}}return e},setCaretAtEnd:function(t){if(void 0!==window.getSelection&&void 0!==document.createRange){var e=document.createRange();e.selectNodeContents(t),e.collapse(!1);var i=window.getSelection();i.removeAllRanges(),i.addRange(e)}else if(void 0!==document.body.createTextRange){var o=document.body.createTextRange();o.moveToElementText(t),o.collapse(!1),o.select()}},cleanStringFromScript:function(t){return"string"==typeof t&&t.replace(/<\/?(?:script|iframe)\b[^>]*>/gm,"")||t},executeCallback:function(t,e){if(t){var i;if("function"==typeof t)i=t;else if(("string"==typeof t||Array.isArray(t))&&("string"==typeof t&&(t=[t,[]]),"function"!=typeof(i=this.helper.namespace.call(this,t[0],window))))return;return i.apply(this,(t[1]||[]).concat(e||[]))}},namespace:function(t,e,i,o){if("string"!=typeof t||""===t)return!1;var s=void 0!==o?o:void 0;if(!~t.indexOf("."))return e[t]||s;for(var n=t.split("."),a=e||window,r=(i=i||"get",""),l=0,c=n.length;l<c;l++){if(void 0===a[r=n[l]]){if(~["get","delete"].indexOf(i))return void 0!==o?o:void 0;a[r]={}}if(~["set","create","delete"].indexOf(i)&&l===c-1){if("set"!==i&&"create"!==i)return delete a[r],!0;a[r]=s}a=a[r]}return a},typeWatch:(i=0,function(t,e){clearTimeout(i),i=setTimeout(t,e)})}},t.fn.typeahead=t.typeahead=function(t){return l.typeahead(this,t)};var l={typeahead:function(i,o){if(o&&o.source&&"object"==typeof o.source){if("function"==typeof i){if(!o.input)return;i=t(o.input)}if(i.length){if(void 0===i[0].value&&(i[0].value=i.text()),1===i.length)return i[0].selector=i.selector||o.input||i[0].nodeName.toLowerCase(),window.Typeahead[i[0].selector]=new e(i,o);for(var s,n={},a=0,r=i.length;a<r;++a)void 0!==n[s=i[a].nodeName.toLowerCase()]&&(s+=a),i[a].selector=s,window.Typeahead[s]=n[s]=new e(i.eq(a),o);return n}}}};return window.console=window.console||{log:function(){}},Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),"indexOf"in Array.prototype||(Array.prototype.indexOf=function(t,e){void 0===e&&(e=0),e<0&&(e+=this.length),e<0&&(e=0);for(var i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1}),Object.keys||(Object.keys=function(t){var e,i=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.push(e);return i}),e}),$(document).ready(function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$('a[href="logout"]').on("click",function(t){t.preventDefault(),$("form.logout_form").submit()});var t,e="all";$(".category_hover_menu .category-item").on("click",function(){$(".category_hover_menu").fadeOut(),setTimeout(function(){$(".category_hover_menu").fadeIn()},1e3);var i=$(this).data("cat");"all"==i?e="all":(e=i,t=$(this).data("alias"));var o=$(this).text();o.length>13&&(o=o.slice(0,13)+"..."),$(".hero__search__categories .cat_value").text(o),$(".advanced-search input").val("")}),$.typeahead({input:"#search_input",minLength:2,order:"desc",maxItem:6,dynamic:!0,delay:500,template:function(t,e){return'<span class="row"><span class=""><img style="width: 40px; padding-right: 10px;" src="'+homedir+"/img/products/"+e.images[0].img+'">{{title}}</span></span>'},emptyTemplate:'По запросу "{{query}}" ничего не найдено',source:{products:{display:"title",href:homedir+"/products/{{alias}}",ajax:function(i){return{type:"GET",url:homedir+"/search",path:"products",data:{query:"{{query}}",cat_id:e,cat_alias:t},callback:{done:function(t){console.log(t)}}}}}},callback:{onClick:function(t,e,i,o){},onSendRequest:function(t,e){console.log("request is sent")},onReceiveRequest:function(t,e){console.log("request is received")}},debug:!0}),$('.advanced-search button[type="submit"]').on("click",function(i){i.preventDefault();var o=$("input#search_input").val();window.location="all"==e?homedir+"/products?filter[title]="+o:homedir+"/products?filter[title]="+o+"&filter[category.alias]="+t,$('input[name="query"]').val(o),$('input[name="cat"]').val(t)}),$("#newsletter_form").validator().on("submit",function(t){if(t.isDefaultPrevented());else{t.preventDefault();var e=$('input[type="email"]').val();console.log(e),$.ajax({url:homedir+"/subscribe",data:{email:e},type:"POST",success:function(t){console.log(t),"subscribed"==t?$("#newsletter_form .success").html("Подписка оформлена"):"unsubscribed"==t?$("#newsletter_form .success").html("Подписка отменена"):"resubscribed"==t&&$("#newsletter_form .success").html("Подписка возобновлена")},error:function(){alert("Ошибка! Попробуйте позже!")}})}});var i=$(".best_product_slider_custom");function o(t){$(".cart-hover").html(t)}function s(t){'<p class="text-center">Корзина пуста</p>'==t.trim()?($("li.cart-icon a.cart-icon-qty").html('<i class="fa fa-shopping-bag"></i>'),$(".header__cart__price").html("")):(total_quantity=$('.cart-hover input[name="total_qty"]').val(),total_products=$('.cart-hover input[name="total_products"]').val(),total_sum=$(".cart-hover .select-total h5").text(),console.log(total_quantity,total_sum),null!=total_quantity&&$("li.cart-icon a.cart-icon-qty").html('<i class="fa fa-shopping-bag"></i><span>'+total_quantity+"</span>"),null!=total_sum&&$(".header__cart__price").html(total_products))}function n(){window.location.href.indexOf("cart")>-1&&($(".loader").fadeIn("slow"),$("#preloder").fadeIn("slow"),location.reload())}function a(t){$.ajax({url:homedir+"/cart/delete/"+t,data:{id:t},type:"DELETE",success:function(t){o(t),s(t),n()},error:function(){alert("Ошибка! Попробуйте позже!")}})}function r(){setTimeout(function(){$("div.cart-error").text("")},2e3)}function l(t){$(".wishlist-hover").html(t)}function c(t){'<p class="text-center">Список пожеланий пуст</p>'==t.trim()?$("li.wishlist-icon a.wishlist-icon-qty").html('<i class="fa fa-heart"></i>'):(total_quantity=$('.wishlist-hover input[name="total_qty"]').val(),null!=total_quantity&&$("li.wishlist-icon a.wishlist-icon-qty").html('<i class="fa fa-heart"></i><span>'+total_quantity+"</span>"))}function h(){window.location.href.indexOf("wishlist")>-1&&($(".loader").fadeIn("slow"),$("#preloder").fadeIn("slow"),location.reload())}function u(t){$.ajax({url:homedir+"/wishlist/delete/"+t,data:{id:t},type:"DELETE",success:function(t){l(t),c(t),h()},error:function(){alert("Ошибка! Попробуйте позже!")}})}i.length&&i.owlCarousel({items:4,loop:!0,dots:!1,autoplay:!0,autoplayHoverPause:!0,autoplayTimeout:5e3,navigation:!1,responsive:{0:{margin:15,items:1,nav:!1},576:{margin:15,items:2,nav:!1},768:{margin:30,items:3,nav:!0},991:{margin:30,items:4,nav:!0}}}),$("body").on("click",".add-tocart-link",function(t){t.preventDefault();var e=$(this).data("id"),i=Number($(".pro-qty input").val()?$(".pro-qty input").val():1),n=$("#niceSelect.option_select").find("option").filter(":selected"),a=n.data("option")?n.data("option"):"",l=$(this).attr("href");console.log(e,i,a,l),"0"==i?($("div.cart-error").text("Пожалуйста, укажите количество больше 0"),r()):($("div.cart-error").text(""),$.ajax({url:l,data:{_token:$('meta[name="csrf-token"]').attr("content"),id:e,qty:i,option:a},type:"POST",success:function(t){console.log(t),o(t),s(t),$("#message_modal").modal("show"),$("#message_modal .modal-body").html('<div class="d-flex flex-column justify-content-center align-items-center"><i class="fa fa-shopping-cart message_icon"></i><p>Товар добавлен в корзину</p></div>'),setTimeout(function(){$("#message_modal").modal("hide")},1500)},error:function(){alert("Ошибка! Попробуйте, пожалуйста, позже.")}}))}),$(".cart-hover").on("click",".fa-close",function(t){t.preventDefault();var e=$(this).data("id");$(this).fadeOut("slow"),a(e)}),$(".js-cart-table .icon_close").on("click",function(){$(this).parents("tr").fadeOut(),a($(this).data("id"))}),$(".cart-hover").on("click","#clearCart",function(t){t.preventDefault(),$.ajax({url:homedir+"/cart/clear",type:"GET",success:function(t){o(t),s(t),n()},error:function(){alert("Ошибка! Попробуйте позже!")}})}),$("#recalculate").on("click",function(t){t.preventDefault();var e=$(".pro-qty input");$(".loader").fadeIn("slow"),$("#preloder").fadeIn("slow");var i=new Array;e.each(function(){var t=parseInt($(this).val()),e={id:$(this).data("id"),qty:t};i.push(e)}),$.ajax({url:homedir+"/cart/recalculate",type:"POST",data:{products_array:i},success:function(t){console.log(t),document.location.reload(!0)},error:function(t){alert("Ошибка! Попробуйте позже!")}})}),$("body").on("click",".add-towish-link",function(t){t.preventDefault();var e=$(this).data("id"),i=Number($(".pro-qty input").val()?$(".pro-qty input").val():1),o=$("#niceSelect.option_select").find("option").filter(":selected"),s=o.data("option")?o.data("option"):"",n=$(this).attr("href");console.log(e,i,s,n),"0"==i?($("div.cart-error").text("Пожалуйста, укажите количество больше 0"),r()):($("div.cart-error").text(""),$.ajax({url:n,data:{_token:$('meta[name="csrf-token"]').attr("content"),id:e,qty:i,option:s},type:"POST",success:function(t){console.log(t),l(t),c(t),$("#message_modal").modal("show"),$("#message_modal .modal-body").html('<div class="d-flex flex-column justify-content-center align-items-center"><i class="fa fa-heart message_icon"></i><p>Товар добавлен в список пожеланий</p></div>'),setTimeout(function(){$("#message_modal").modal("hide")},1500)},error:function(){alert("Ошибка! Попробуйте, пожалуйста, позже.")}}))}),$(".wishlist-hover").on("click",".fa-close",function(t){t.preventDefault();var e=$(this).data("id");$(this).fadeOut("slow"),u(e)}),$(".js-wish-table .icon_close").on("click",function(){$(this).parents("tr").fadeOut(),u($(this).data("id"))}),$("body").on("click",".move-to-cart",function(){$(this).parents("tr").fadeOut("slow");var t=$(this).data("productid"),e=$(this).data("id"),i=$(this).data("option");$.ajax({url:homedir+"/cart/add/"+t,data:{id:t,option:i,wishToCart:!0},type:"POST",success:function(t){t&&(u(e),o(t),s(t),h())},error:function(){alert("Ошибка! Попробуйте позже!")}})}),$("body").on("click","#clearWishList",function(t){t.preventDefault(),$.ajax({url:homedir+"/wishlist/clear",type:"GET",success:function(t){console.log(t),l(t),c(t),h()},error:function(){alert("Ошибка! Попробуйте позже!")}})}),$('.checkout__input__checkbox input[name="shipping"]').on("click",function(){var t=$(this).data("value");$('input[name="shipping_method"]').val(t),console.log($('input[name="shipping_method"]').val())}),$('.checkout__input__checkbox input[name="pay"]').on("click",function(){var t=$(this).data("value");$('input[name="pay_method"]').val(t),console.log($('input[name="pay_method"]').val())}),$("button#checkout_finish").on("click",function(t){t.preventDefault();var e=$('input[name="shipping_method"]').val(),i=$('input[name="pay_method"]').val();$("#methods_error").html(""),""==i&&($("#methods_error").append("Не указан способ оплаты<br>"),$("#methods_error").removeClass("d-none")),""==e?($("#methods_error").append("Не указан способ доставки<br>"),$("#methods_error").removeClass("d-none")):""!=i&&""!=e&&$("#checkout_form").submit()})});
